# ç«¯å£æ‰«æåŠŸèƒ½å®ç°è¯´æ˜

## ğŸ¯ å®ç°æ¦‚è¿°

å·²æˆåŠŸå®ç°å®Œæ•´çš„ç«¯å£æ‰«æåŠŸèƒ½ï¼ŒåŒ…æ‹¬åç«¯é€»è¾‘å’Œå‰ç«¯äº¤äº’ã€‚

## ğŸ“‹ å®ç°å†…å®¹

### 1. åç«¯å®ç° (`internal/scanner/scanner.go`)

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… TCPç«¯å£è¿æ¥æ‰«æ
- âœ… æ”¯æŒç«¯å£èŒƒå›´æ ¼å¼ï¼š`1-1000`
- âœ… æ”¯æŒç«¯å£åˆ—è¡¨æ ¼å¼ï¼š`80,443,8080`
- âœ… å¹¶å‘æ‰«æï¼ˆæœ€å¤š100ä¸ªå¹¶å‘è¿æ¥ï¼‰
- âœ… 2ç§’è¶…æ—¶æ§åˆ¶
- âœ… æ™ºèƒ½é™åˆ¶æœ€å¤§ç«¯å£èŒƒå›´ï¼ˆ10000ä¸ªï¼‰

#### ä¸»è¦å‡½æ•°

**`parsePortRange(portRange string)`**
- è§£æç«¯å£èŒƒå›´æˆ–åˆ—è¡¨
- è¿”å›ç«¯å£æ•°ç»„
- æ”¯æŒä¸‰ç§æ ¼å¼ï¼š
  - èŒƒå›´ï¼š`"1-1000"` â†’ `[1, 2, ..., 1000]`
  - åˆ—è¡¨ï¼š`"80,443,8080"` â†’ `[80, 443, 8080]`
  - å•ç«¯å£ï¼š`"80"` â†’ `[80]`

**`scanSinglePort(target, port, timeout)`**
- æ‰«æå•ä¸ªç«¯å£
- ä½¿ç”¨ `net.DialTimeout` è¿›è¡ŒTCPè¿æ¥
- è¿”å›ç«¯å£çŠ¶æ€ï¼ˆå¼€æ”¾/å…³é—­ï¼‰

**`ScanPorts(target, portRange)`**
- ä¸»æ‰«æå‡½æ•°
- ä½¿ç”¨ Goroutines å¹¶å‘æ‰«æ
- ä½¿ç”¨ä¿¡å·é‡é™åˆ¶å¹¶å‘æ•°
- ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤ç»“æœé›†
- åªè¿”å›å¼€æ”¾çš„ç«¯å£

### 2. å‰ç«¯å¯¹æ¥ (`internal/app.go`)

#### ä¿®æ”¹å†…å®¹
```go
func (a *App) ScanPorts(target string, portRange string) string {
    // æ‰§è¡Œç«¯å£æ‰«æ
    results, err := scanner.ScanPorts(target, portRange)
    if err != nil {
        return fmt.Sprintf("é”™è¯¯: %v", err)
    }
    
    // å°†ç»“æœè½¬æ¢ä¸ºJSONæ ¼å¼è¿”å›
    jsonData, err := json.Marshal(results)
    if err != nil {
        return fmt.Sprintf("é”™è¯¯: åºåˆ—åŒ–ç»“æœå¤±è´¥: %v", err)
    }
    
    return string(jsonData)
}
```

### 3. å‰ç«¯æ˜¾ç¤º (`frontend/app.js`)

#### ä¿®æ”¹å†…å®¹
- è§£æJSONæ ¼å¼çš„æ‰«æç»“æœ
- æ ¼å¼åŒ–æ˜¾ç¤ºå¼€æ”¾çš„ç«¯å£
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·å‹å¥½çš„æç¤º
- ä½¿ç”¨ä¸åŒé¢œè‰²æ˜¾ç¤ºä¸åŒç±»å‹çš„ä¿¡æ¯

## ğŸ” ä½¿ç”¨ç¤ºä¾‹

### GUIæ–¹å¼
1. å¯åŠ¨åº”ç”¨ï¼š`./dev.sh`
2. ç‚¹å‡» `[1] ç«¯å£æ‰«æ`
3. è¾“å…¥ç›®æ ‡ï¼š`scanme.nmap.org`
4. è¾“å…¥ç«¯å£èŒƒå›´ï¼š`1-1000`
5. ç‚¹å‡»"æ‰§è¡Œæ‰«æ"

### é¢„æœŸè¾“å‡º
```
[INFO] [SCAN] å¼€å§‹æ‰«æ: scanme.nmap.org
[INFO] ç«¯å£èŒƒå›´: 1-1000
[SUCCESS] âœ… å‘ç° 5 ä¸ªå¼€æ”¾ç«¯å£:
[SUCCESS]   ç«¯å£ 22: å¼€æ”¾
[SUCCESS]   ç«¯å£ 80: å¼€æ”¾
[SUCCESS]   ç«¯å£ 9929: å¼€æ”¾
[SUCCESS]   ç«¯å£ 31337: å¼€æ”¾
[SUCCESS]   ç«¯å£ 54321: å¼€æ”¾
```

## âš¡ æ€§èƒ½ç‰¹ç‚¹

1. **å¹¶å‘æ§åˆ¶**: ä½¿ç”¨ Channel ä½œä¸ºä¿¡å·é‡ï¼Œé™åˆ¶æœ€å¤š100ä¸ªå¹¶å‘è¿æ¥
2. **è¶…æ—¶è®¾ç½®**: æ¯ä¸ªç«¯å£2ç§’è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
3. **å†…å­˜ä¼˜åŒ–**: åªä¿å­˜å¼€æ”¾çš„ç«¯å£ï¼Œå…³é—­çš„ç«¯å£ä¸ä¿å­˜
4. **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨ `sync.Mutex` ä¿æŠ¤å¹¶å‘å†™å…¥

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: GUIæµ‹è¯•
```bash
./dev.sh
# åœ¨ç•Œé¢ä¸­æµ‹è¯•
```

### æ–¹æ³•2: CLIæµ‹è¯•
```bash
# ç¼–è¯‘CLIç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦ï¼‰
go build -o web-pen-cli ./cmd/*.go

# æµ‹è¯•æ‰«æ
./web-pen-cli scan scanme.nmap.org --ports=22,80,443
```

### æ–¹æ³•3: å•å…ƒæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
```go
// å¯ä»¥æ·»åŠ åˆ° scanner_test.go
func TestScanPorts(t *testing.T) {
    results, err := ScanPorts("scanme.nmap.org", "22,80,443")
    assert.NoError(t, err)
    assert.NotEmpty(t, results)
}
```

## ğŸ“Š ä»£ç ç»“æ„

```
internal/scanner/scanner.go
â”œâ”€â”€ parsePortRange()      # è§£æç«¯å£èŒƒå›´
â”œâ”€â”€ scanSinglePort()      # æ‰«æå•ä¸ªç«¯å£
â””â”€â”€ ScanPorts()          # ä¸»æ‰«æå‡½æ•°ï¼ˆå¹¶å‘ï¼‰

internal/app.go
â””â”€â”€ ScanPorts()          # å‰ç«¯æ¥å£ï¼ˆJSONæ ¼å¼ï¼‰

frontend/app.js
â””â”€â”€ æ‰«ææŒ‰é’®äº‹ä»¶ç›‘å¬å™¨   # UIäº¤äº’
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å¹¶å‘æ¨¡å‹
```go
// åˆ›å»ºä¿¡å·é‡ï¼ˆæœ€å¤š100ä¸ªå¹¶å‘ï¼‰
semaphore := make(chan struct{}, 100)

// å¹¶å‘æ‰«æ
for _, port := range ports {
    go func(p int) {
        semaphore <- struct{}{}  // è·å–ä¿¡å·é‡
        defer func() { <-semaphore }()  // é‡Šæ”¾ä¿¡å·é‡
        
        // æ‰§è¡Œæ‰«æ
        result := scanSinglePort(target, p, timeout)
        
        // ä¿å­˜ç»“æœ
        mu.Lock()
        if result.Status == "å¼€æ”¾" {
            results = append(results, result)
        }
        mu.Unlock()
    }(port)
}
```

### è¶…æ—¶æ§åˆ¶
```go
timeout := 2 * time.Second
conn, err := net.DialTimeout("tcp", address, timeout)
```

## âœ… å®ŒæˆçŠ¶æ€

- [x] åç«¯æ‰«æé€»è¾‘
- [x] JSONåºåˆ—åŒ–
- [x] å‰ç«¯è°ƒç”¨
- [x] ç»“æœæ˜¾ç¤º
- [x] é”™è¯¯å¤„ç†
- [x] å¹¶å‘æ§åˆ¶
- [x] è¶…æ—¶å¤„ç†
- [x] æ–‡æ¡£ç¼–å†™

## ğŸš€ ä¸‹ä¸€æ­¥

è€ƒè™‘æ·»åŠ çš„åŠŸèƒ½ï¼š
1. æ˜¾ç¤ºæ‰«æè¿›åº¦ï¼ˆå·²å®Œæˆ/æ€»æ•°ï¼‰
2. å¯¼å‡ºæ‰«æç»“æœä¸ºJSONæ–‡ä»¶
3. è¯†åˆ«ç«¯å£å¯¹åº”çš„æœåŠ¡ç±»å‹
4. æ”¯æŒUDPç«¯å£æ‰«æ

